### fnc_personal_offers_focused_on_cross_selling функция, определяющая предложения, ориентированные на кросс-продажи (рост маржи)

Параметры функции:
- количество групп
- максимальный индекс оттока
- максимальный индекс стабильности потребления
- максимальная доля SKU (в процентах)
- допустимая доля маржи (в процентах)

Предложения, ориентированные на рост маржи за счет кросс-продаж,
подразумевают переключение клиента на максимально маржинальное SKU в
рамках востребованной им группы.

1.  **Выбор групп.** Для формирования предложений, ориентированных на
    рост маржи за счет кросс-продаж, для каждого клиента выбирается несколько
    групп (количество *задается* пользователем) с
    максимальным индексом востребованности, отвечающие следующим
    условиям:

    1.  Индекс оттока по группе не более заданного пользователем значения.

    2.  Индекс стабильности потребления группы составляет менее заданного пользователем значения.

2.  **Определение SKU с максимальной маржой.** В каждой группе
    определяется SKU с максимальной маржой (в рублях). Для этого по
    основному магазину клиента из розничной цены товара
    (`SKU_Retail_Price`) вычитается его закупочная стоимость
    (`SKU_Purchase_Price`) для всех SKU данной группы, представленных
    в магазине, после чего выбирается одно SKU с максимальным
    значением указанной разницы.

3.  **Определение доли SKU в группе.** Определяется доля транзакций, в
    которых присутствует анализируемое SKU. Для этого количество
    транзакций, содержащих данный SKU, делится на количество
    транзакций, содержащих группу в целом (за анализируемый период).
    SKU используется для формирования предложения только в том случае,
    если получившееся значение не превышает заданного пользователем значения.

4.  **Определение доли маржи для расчета скидки.** Пользователь *вручную
    определяет* долю маржи (в процентах), которую допустимо
    использовать для предоставления вознаграждения по SKU (задается
    единое значение для всей совокупности клиентов).

5.  **Расчет скидки.** *Заданное* пользователем на шаге 4 значение
    умножается на разницу между розничной (`SKU_Retail_Price`) и
    закупочной (`SKU_Purchase_Price`) ценой, а получившееся значение
    делится на розничную цену SKU (`SKU_Retail_Price`). Все цены – для
    основного магазина клиента. В случае, если получившееся значение
    равно или превышает минимальный размер скидки пользователя для
    анализируемой группы, округленной вверх с шагом в 5%, то в
    качестве скидки для данного SKU для клиента устанавливается
    минимальная скидка для группы, округленная вверх с шагом в 5%. В
    противном случае для клиента не формируется предложение по данной
    группе.

Вывод функции:

| **Поле**                    | **Название поля в системе** | **Формат / возможные значения**            | **Описание**                                                                            |
|-----------------------------|-----------------------------|--------------------------------------------|-----------------------------------------------------------------------------------------|
| Идентификатор клиента       | Customer_ID                 |                                            |                                                                                         |
| SKU предложения             | SKU_Name                    |                                            | Название SKU предложения, на который начисляется вознаграждение при выполнении условия. |
| Максимальная глубина скидки | Offer_Discount_Depth        | Арабская цифра (десятичная дробь), процент | Максимально возможный размер скидки для предложения                                     |
